<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <!-- Buefy CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.6.1/css/bulma.css">
  <link rel="stylesheet" href="//cdn.materialdesignicons.com/2.0.46/css/materialdesignicons.min.css">
  <link rel="stylesheet" href="/assets/css/style.css">
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="https://unpkg.com/vue"></script>
</head>
<body>
  <div id="home">
    <nav class="level">
      <!-- Left side -->
      <div class="level-left">
        <div class="level-item">
          <p class="subtitle is-5">
            <strong>Todo</strong> List
          </p>
        </div>
      </div>

      <!-- Right side -->
      <div class="level-right">
        <p class="level-item"><a class="button is-info" @click='logout()'>logout</a></p>
      </div>
    </nav>
    <section class="hero is-primary">
      <div class="hero-body">
        <div class="container">
          <h1 class="title">
            {{name}}
          </h1>
          <h2 class="subtitle">
            Your ToDo
          </h2>
        </div>
      </div>
    </section>

    <div class="columns is-mobile">
      <div class="column is-three-fifths is-offset-one-fifth">
        <div id="myDIV" class="header">
          <h2>Create a New To Do List</h2>
          <form >
          <div class="field" style="margin-top: 20px">
              <div class="control is-expanded">
                <input class="input" type="text" v-model="newTask.task" placeholder="Task Name">
                <textarea class="textarea" v-model= 'newTask.description' placeholder="Descriptions"></textarea>
            <div class="control">
              <input type="reset" class="button is-info" @click='createTask()' value='Create'>
            </div>
          </div>
          </div>
          </form>
        </div>
      </div>
    </div>
    <div class="columns">
      <div class="column" style="background-color: #00d1b2;">
        <p style="color: white; font-size:3rem">Todo List</p>
          <div >
            <article class="media" v-for='task in tasks'>
              <figure class="media-left">
                <p class="image is-64x64">
                  <img :src="picture">
                </p>
              </figure>
              <div class="media-content">
                <div class="content">
                  <p>
                    <strong>{{task.task}}</strong> <small>@johnsmith</small> <small>31m</small>
                    <br>
                      {{task.description}}
                  </p>
                </div>
                <nav class="level is-mobile">
                  <div class="level-left">
                      <p class="level-item has-text-centered">
                          <a class="link is-info"  @click='completedTask(task._id)'>Complete</a>
                        </p>
                        <p class="level-item has-text-centered">
                          <a class="link is-info">Edit</a>
                        </p>
                        <p class="level-item has-text-centered">
                          <a class="link is-info" @click='deleteTask(task._id, task.status)'>Delete</a>
                        </p>
                  </div>
                </nav>
              </div>
            </article>
          </div>
        </div>
      <div class="column" style="background-color: #00d1b2;">
          <p style="color: white; font-size:3rem">Complete List Todo</p>
          <div  >
            <article class="media" v-for='task in taskComplete'>
              <figure class="media-left">
                <p class="image is-64x64">
                  <img :src="picture">
                </p>
              </figure>
                <div class="media-content">
                  <div class="content">
                    <p>
                      <strong>{{task.task}}</strong> <small>@johnsmith</small> <small>31m</small>
                      <br>
                      {{task.description}}
                    </p>
                  </div>
                  <nav class="level is-mobile">
                    <div class="level-left">
                      <p class="level-item has-text-centered">
                        <a class="link is-info" @click='uncompleteTask(task._id)'>Uncomplete</a>
                      </p>
                      <p class="level-item has-text-centered">
                        <a class="link is-info">Edit</a>
                        <div class="modal">
                          <div class="modal-background"></div>
                          <div class="modal-card">
                            <header class="modal-card-head">
                              <p class="modal-card-title">Modal title</p>
                              <button class="delete" aria-label="close"></button>
                            </header>
                            <section class="modal-card-body">
                              <!-- Content ... -->
                            </section>
                            <footer class="modal-card-foot">
                              <button class="button is-success">Save changes</button>
                              <button class="button">Cancel</button>
                            </footer>
                          </div>
                        </div>
                      </p>
                      <p class="level-item has-text-centered">
                          <a class="link is-info" @click='deleteTask(task._id, task.status)'>Delete</a>
                        </p>
                    </div>
                  </nav>
                </div>
            </article>
          </div>
        </div>
      </div>
    </div>
  <!-- Main container -->
</body>
<script src="https://use.fontawesome.com/65915c81b2.js"></script>
<script>
  let http = axios.create({
    baseURL: 'http://35.197.134.9:3001/',
    headers: {'token' : localStorage.getItem('token')}
  })
  new Vue({
    el: '#home',
    data:{
      tasks : [],
      taskComplete: [],
      name: '',
      picture: '',
      newTask: {task : '', description: ''},
      classObject: 'is-active'
    },
    methods: {
      logout : function(){
        localStorage.removeItem('token')
        localStorage.removeItem('id')
        window.location= 'http://todo-fancy.pangestu.tech/signUp.html'
      },
      createTask: function(){
        http.post('api/create-task', this.newTask)
        .then(({data}) => {
          this.newTask =  {task : '', description: ''}
          this.tasks.unshift(data.data)
        })
        .catch(err => console.error(err))
      },
      completedTask: function(id){
        let index = 0
          var array = this.tasks.filter(function(task, i){
            if (task._id == id) {
              index = i
              return task
            }
          });
        this.taskComplete.unshift(array[0])
        this.tasks.splice(index, 1)

        http.put(`api/mark-task/${id}`,{'status': true})
        .then(({data}) => {
         console.log(data)
        })
        .catch(err => console.log('ini error complete',err))
      },
      uncompleteTask: function(id){
        let index = 0
          var array = this.taskComplete.filter(function(task, i){
            if (task._id == id) {
              index = i
              return task
            }
          });
        this.tasks.unshift(array[0])
        this.taskComplete.splice(index, 1)

        http.put(`api/mark-task/${id}`,{'status': false})
        .then(({data}) => {
          console.log(data)
        })
        .catch(err => console.log('ini error complete',err))
      },
      deleteTask: function(id, status){
        if(status){
          let index = 0
          let array = this.taskComplete.filter(function(task, i) {
            if (task._id == id) {
              return index = i
            }
            // this.taskComplete.splice(array, 1)
          });
          this.taskComplete.splice(index, 1)
          index = 0
        }
        else{
          let array = this.tasks.filter(function(task, i) {
            if (task._id == id) {
              return index = i
            }
          });
          this.tasks.splice(index, 1)
          index = 0
        }
        http.delete(`api/delete-task/${id}`)
        .then(({data}) => {
          console.log('sukses')
        })
        .catch(err => console.log(err))
      }
    },
    created: function (){
      this.picture = localStorage.getItem('picture')
      this.name = localStorage.getItem('name')
      if(!localStorage.token){
        window.location = 'http://todo-fancy.pangestu.tech/signUp.html'
      }
      else{
        http.get('api/get-all-user_task')
        .then( ({data}) => {
          data.data.forEach(data => {
            if(data.status == true) {
              this.taskComplete.push(data)

            }
            else {
              this.tasks.push(data)
            }
          })
        })
        .catch(err => console.error(err))
      }
    }
  })
</script>
</html>
